# 単体テスト実行手順

– server side –  
このドキュメントでは、`heresme-sv-tests.zip`を受け取った後、full testを実行するまでの手順を説明します。

## 前提条件

- Git がインストールされていること  
- Node.js (v12以降推奨) がインストールされていること  
- npm がインストールされていること  
- unzip コマンドが使用可能であること

## 手順1: リポジトリのクローン

まず、heresme-svリポジトリをクローンします。

git clone \<repository-url\> heresme-sv

cd heresme-sv

## 手順2: zipアーカイブの展開

受け取ったzipファイルをリポジトリのルートディレクトリに配置し、展開します。

\# zipファイルをリポジトリルートにコピー（既にある場合はスキップ）

\# cp /path/to/heresme-sv-tests.zip .

\# zipファイルを展開（既存ファイルは上書きされます）

unzip \-o heresme-sv-tests.zip

\# 展開されたファイルを確認

ls \-la

### 展開されるファイル一覧

- **テストファイル (14個)**  
    
  - tests/app.test.js  
  - tests/config/auth-config.test.js  
  - tests/util/logger-wrapper.test.js  
  - tests/util/hm-util.test.js  
  - tests/models/\*.test.js (10個)


- **ソースファイル (15個)**  
    
  - app.js  
  - config/auth-config.js, log4js-config.json  
  - util/logger-wrapper.js, hm-util.js  
  - models/\*.js (10個)


- **設定ファイル (3個)**  
    
  - package.json  
  - jest.config.js  
  - Makefile


- **サポートディレクトリ (4個)**  
    
  - bin/  
  - routes/  
  - views/  
  - public/

## 手順3: 依存パッケージのインストール

`make install` を実行して、必要な依存パッケージをインストールします。

make install

または、直接npmコマンドを使用することもできます：

npm install

### インストールされるパッケージ

- **本番依存パッケージ**: express, pg, aws-sdk, log4js, 等  
- **開発依存パッケージ**: jest, supertest

## 手順4: full testの実行

依存パッケージのインストールが完了したら、full testを実行します。

### 4-1. カバレッジ付きテスト実行（推奨）

make test-coverage

または：

npm run test:coverage

### 4-2. 通常のテスト実行

make test

または：

npm test

### 4-3. 詳細モードでのテスト実行

make test-verbose

または：

npm run test:verbose

## テスト結果の確認

### 成功時の出力例

Test Suites: 12 passed, 14 total

Tests:       263 passed, 267 total

Coverage:    89.96%

### カバレッジレポートの確認

カバレッジ付きでテストを実行すると、`coverage/` ディレクトリにHTMLレポートが生成されます。

\# ブラウザでカバレッジレポートを開く

open coverage/lcov-report/index.html  \# macOS

xdg-open coverage/lcov-report/index.html  \# Linux

## 個別テストの実行

特定のテストファイルのみを実行したい場合は、以下のコマンドを使用します。

\# 新規4テストのみ実行

make test-new

\# 個別テスト実行

make test-db-util           \# db-util.test.js のみ

make test-logger-wrapper    \# logger-wrapper.test.js のみ

make test-auth-config       \# auth-config.test.js のみ

make test-app               \# app.test.js のみ

## トラブルシューティング

### 問題1: npm installが失敗する

\# package-lock.json を削除して再試行

rm \-f package-lock.json

npm install

### 問題2: テストが失敗する（既知の問題）

以下の失敗は既知の問題です：

- **geolocation.test.js**: 2テスト失敗（Bug-001 \- 実装不具合）  
- **login-auth.test.js**: 2テスト失敗（統合テスト対応が必要）

詳細は以下のドキュメントを参照してください：

- `doc/known-bugs.md`  
- `doc/integration-test-notes.md`

### 問題3: 権限エラーが発生する

\# Makefileに実行権限を付与

chmod \+x Makefile

\# binディレクトリのスクリプトに実行権限を付与

chmod \+x bin/\*

## 代替方法: zipファイルのみでテスト環境を構築

リポジトリをクローンせずに、zipファイルのみでテスト環境を構築することも可能です。

\# 新規ディレクトリを作成

mkdir heresme-sv-test

cd heresme-sv-test

\# zipファイルを展開

unzip /path/to/heresme-sv-tests.zip

\# 依存パッケージをインストール

npm install

\# テストを実行

npm run test:coverage

**注意**: この方法では、Gitの履歴情報は含まれません。

## クリーンアップ

テスト完了後、環境をクリーンアップする場合：

\# node\_modulesとzipファイルを削除

make clean

\# カバレッジレポートも削除

rm \-rf coverage/

## まとめ

基本的な手順は以下の通りです：

1. `git clone <repository-url> heresme-sv`  
2. `cd heresme-sv`  
3. `unzip -o heresme-sv-tests.zip`  
4. `make install`  
5. `make test-coverage`

所要時間: 約5-10分（ネットワーク速度により変動）

## 関連ドキュメント

- `doc/unit-test-setup.md` \- テスト環境のセットアップ詳細  
- `doc/known-bugs.md` \- 既知の不具合一覧  
- `doc/integration-test-notes.md` \- 統合テストに関する注意事項  
- `Makefile` \- 利用可能なmakeターゲット一覧（`make help`で確認）

